# Twins Delivery - CSV Import Guide

This guide explains how to import the CSV files generated by the converter into Supabase.

## Requirements

- Access to your Supabase project dashboard
- CSV files generated by the `json_to_csv_converter.py` script

## Generated CSV Files

The converter script generates the following CSV files in the `csv_exports/combined/` directory:

1. `restaurants.csv` - Contains restaurant information
2. `menu_categories.csv` - Contains menu category information, linked to restaurants
3. `menu_items.csv` - Contains menu item information, linked to categories

## CSV Format

### restaurants.csv
- `id` (UUID): Primary key
- `slug` (Text): URL-friendly name
- `name` (Text): Restaurant name
- `image_url` (Text): Restaurant image URL
- `cuisine` (Text): Primary cuisine type
- `rating` (Number): Restaurant rating
- `reviews` (Number): Number of reviews
- `delivery_time` (Text): Estimated delivery time
- `price` (Text): Price level indicator
- `badge` (JSON): Badge information
- `dietary` (JSON array): Dietary options
- `description` (Text): Restaurant description

### menu_categories.csv
- `id` (UUID): Primary key
- `name` (Text): Category name
- `restaurant_id` (UUID): Foreign key to restaurants table

### menu_items.csv
- `id` (UUID): Primary key
- `category_id` (UUID): Foreign key to menu_categories table
- `name` (Text): Item name
- `description` (Text): Item description
- `price` (Number): Item price
- `currency` (Text): Currency code
- `image_url` (Text): Item image URL

## Important Update

**Fixed: Restaurant ID Association**

We've fixed an issue where menu categories weren't properly associated with their restaurants. The updated `json_to_csv_converter.py` script now correctly sets the `restaurant_id` field in the `menu_categories.csv` file. This ensures that when you view a restaurant's menu, you'll see all its categories and menu items.

## How to Import CSV Files

Follow these steps to import the CSV files into your Supabase tables:

### Step 1: Access Supabase Dashboard

1. Log in to your Supabase dashboard
2. Select your project
3. Go to the "Table Editor" section

### Step 2: Create Tables (if they don't exist)

Create the following tables with their respective columns:

- `restaurants` (as per the schema above)
- `menu_categories` (as per the schema above)
- `menu_items` (as per the schema above)

### Step 3: Import CSV Data

**Important: Import the tables in this exact order to maintain foreign key relationships:**

1. First import `restaurants.csv` into the `restaurants` table
2. Then import `menu_categories.csv` into the `menu_categories` table
3. Finally import `menu_items.csv` into the `menu_items` table

For each import:

1. Click on the table name in the Table Editor
2. Click "Import data from CSV"
3. Upload the corresponding CSV file
4. Match the columns if prompted
5. Click "Import"

## Common Import Errors

### "Column Not Found" Error

If you see an error about a column not being found in the table schema:

1. Check that your table schema exactly matches the CSV format
2. Ensure column names match exactly (case sensitive)
3. If needed, modify your CSV headers to match the table schema

### Foreign Key Constraint Violation

If you see errors about foreign key constraints:

1. Make sure you're importing the tables in the correct order (restaurants → categories → items)
2. Verify that the `restaurant_id` in `menu_categories.csv` matches valid IDs in the `restaurants` table
3. Verify that the `category_id` in `menu_items.csv` matches valid IDs in the `menu_categories` table

## Troubleshooting

If menus don't display properly in your application:

1. Check that menu categories are properly associated with restaurant IDs
2. Verify that menu items are linked to the correct category IDs
3. Run database queries to confirm relationships are correct

Example query to check category-restaurant relationships:
```sql
SELECT c.name as category_name, r.name as restaurant_name
FROM menu_categories c
JOIN restaurants r ON c.restaurant_id = r.id
ORDER BY r.name, c.name;
```

Example query to check item-category relationships:
```sql
SELECT i.name as item_name, c.name as category_name, r.name as restaurant_name
FROM menu_items i
JOIN menu_categories c ON i.category_id = c.id
JOIN restaurants r ON c.restaurant_id = r.id
ORDER BY r.name, c.name, i.name;
```

For any issues, consider regenerating the CSV files using the latest version of the converter script. 